# OWL 功能增强设计方案

> 设计日期: 2025-12-29
> 状态: 已审核
> 版本: 1.0

## 概述

本设计方案规划 OWL 知识库平台的四大功能增强模块，旨在将静态知识库转化为智能化、交互式的创新空间规划平台。

## 设计目标

1. **Agentic RAG 问答** — 智能问答系统，支持多步推理和跨模块检索
2. **智能推荐系统** — 根据用户场景参数生成个性化方案
3. **内容可视化** — 将知识库内容转化为交互式图表和组件
4. **Lab 工具增强** — 提升现有工具能力，新增实用工具

---

## 模块一：Agentic RAG 问答系统

### 1.1 目标

用户用自然语言提问，AI Agent 基于 OWL 知识库内容进行多步推理并回答。

### 1.2 技术架构

```
用户提问
    ↓
┌─────────────────────────────────────────┐
│  AI Agent (规划层)                        │
│  - 分析问题复杂度                         │
│  - 制定检索策略 (单步/多步)               │
│  - 决定使用哪些工具                       │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│  工具集 (Agent 可调用)                    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │知识库检索│ │跨模块关联│ │ 案例匹配 │    │
│  └─────────┘ └─────────┘ └─────────┘    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │证据验证 │ │ 计算工具 │ │ 图表生成 │    │
│  └─────────┘ └─────────┘ └─────────┘    │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│  推理循环 (ReAct 模式)                    │
│  Thought → Action → Observation → ...   │
│  支持多轮检索和自我纠正                   │
└─────────────────────────────────────────┘
    ↓
结构化回答 + 推理过程可视化
```

### 1.3 核心特性

| 特性 | 描述 |
|------|------|
| **多步推理** | 复杂问题自动拆解（如"如何建一个50㎡的创客空间"涉及 M03/M05/M06 多模块） |
| **跨模块检索** | 自动识别问题涉及的多个知识模块 |
| **自我纠正** | 检测回答不完整时自动补充检索 |
| **来源引用** | 回答附带文档来源链接，可点击跳转 |
| **推理可视化** | 可展示 Thought → Action → Observation 过程 |
| **上下文对话** | 支持追问和多轮对话 |

### 1.4 技术选型

| 组件 | 技术方案 |
|------|----------|
| 向量嵌入 | OpenAI Embeddings (text-embedding-3-small) |
| 向量存储 | Vercel Postgres + pgvector 或 Pinecone |
| Agent 框架 | LangChain / Vercel AI SDK |
| LLM | GPT-4o / Claude 3.5 Sonnet |
| 推理模式 | ReAct (Reasoning + Acting) |

### 1.5 UI 设计

- **入口位置**: 全局浮动按钮 + 文档页侧边栏
- **交互形式**: 聊天式对话界面
- **特色功能**:
  - 推理过程折叠展示
  - 引用文档预览卡片
  - 快捷问题建议

---

## 模块二：智能推荐系统

### 2.1 目标

根据用户场景参数，推荐个性化的空间建设方案。

### 2.2 输入参数

| 参数 | 类型 | 示例值 |
|------|------|--------|
| 空间面积 | 选择 | 50㎡ / 100㎡ / 200㎡+ |
| 预算范围 | 范围 | 5万 / 10万 / 30万+ |
| 目标年龄段 | 多选 | 小学 / 初中 / 高中 / 混龄 |
| 侧重方向 | 多选 | STEM / 艺术创客 / AI教育 / 综合 |
| 场地条件 | 选择 | 新建 / 改造 / 教室改装 |
| 人员配置 | 输入 | 专职导师数 / 志愿者数 |

### 2.3 输出内容

```
推荐方案
├── 空间布局建议
│   └── 调用 /api/ai/generate-layout
├── 设备清单 + 预算分配
│   └── 调用 /api/ai/recommend-equipment
├── 安全配置要求
│   └── 调用 /api/ai/safety-analysis
├── 分阶段采购建议
│   └── 按优先级排序，支持分期实施
└── 参考案例
    └── 从知识库匹配相似规模/定位的案例
```

### 2.4 与 Agentic RAG 协同

推荐系统作为 Agent 的一个工具，用户问"我有10万预算想建创客空间"时自动触发：

```python
# Agent 工具定义示例
tools = [
    Tool(
        name="space_recommendation",
        description="根据预算、面积、年龄段等参数推荐创客空间建设方案",
        parameters={
            "budget": "预算金额",
            "area": "空间面积",
            "age_group": "目标年龄段",
            ...
        }
    )
]
```

### 2.5 UI 设计

- **入口**: Lab 页面新增"智能规划向导"入口
- **交互**: 步骤式表单 → 方案生成 → 可调整优化
- **输出**: 可导出为 PDF 报告 / 可保存为项目

---

## 模块三：内容可视化

### 3.1 知识图谱

**目标**: 可视化展示 OWL 9 大模块及其关联关系

```
┌─────────────────────────────────────────────────┐
│                  OWL 知识图谱                    │
│                                                 │
│         M01理念 ──── M04课程                     │
│           │    ╲   ╱    │                       │
│           │     ╲ ╱     │                       │
│         M02治理 ─ ✦ ─ M07人员                    │
│           │     ╱ ╲     │                       │
│           │    ╱   ╲    │                       │
│         M03空间 ──── M05工具                     │
│              ╲       ╱                          │
│               M06安全                            │
│                                                 │
│  [点击节点展开详情] [筛选模块] [搜索概念]         │
└─────────────────────────────────────────────────┘
```

**功能**:
- 模块间关联可视化（基于文档交叉引用分析）
- 点击节点展开核心概念和子文档
- 支持搜索定位到具体概念
- 缩放和拖拽交互

**技术**: D3.js / React Flow / vis-network

### 3.2 交互式检查清单

**目标**: 将文档中的检查表转为可勾选、可保存的交互组件

```
┌─────────────────────────────────────────┐
│ 📋 创客空间安全检查表          进度: 3/12 │
├─────────────────────────────────────────┤
│ ☑ 消防设备到位                          │
│ ☑ 急救箱配置完成                        │
│ ☑ 安全标识张贴                          │
│ ☐ 设备操作规程上墙                      │
│ ☐ 应急疏散路线标识                      │
│ ☐ 电气安全检查                          │
│ ...                                     │
├─────────────────────────────────────────┤
│ [导出PDF] [保存进度] [分享链接]          │
└─────────────────────────────────────────┘
```

**功能**:
- 勾选状态本地持久化 (localStorage)
- 可选登录后云端同步
- 导出为 PDF 检查报告
- 生成可分享的进度链接

**数据来源**: 从 MDX 文档中提取 `□` 检查项，自动生成

### 3.3 流程图 / 决策树

**目标**: 将复杂流程转为交互式导航

```
设备使用准入流程:

[新用户] → [完成安全培训?]
              ├─ 否 → [预约培训] → [完成培训] ─┐
              └─ 是 → [设备分级?]              │
                        ├─ S1/S2 → [直接使用]  │
                        └─ S3/S4 → [专项认证] →┘
                                       ↓
                                  [预约使用]
```

**功能**:
- 当前节点高亮
- 点击节点查看详细说明
- 可嵌入文档页面
- 支持从 Mermaid 语法自动生成

**技术**: Mermaid.js / React Flow

### 3.4 可视化组件库

创建可复用的 MDX 组件：

```tsx
// 使用示例
<KnowledgeGraph module="M03" depth={2} />

<Checklist
  id="safety-check"
  source="/docs/zh/knowledge-base/06-safety/extend/risk-assessment"
/>

<FlowChart src="equipment-access-flow" interactive />
```

---

## 模块四：Lab 工具增强

### 4.1 平面图编辑器增强

| 现有功能 | 增强方向 | 优先级 |
|---------|---------|--------|
| 拖拽放置设备 | + **智能布局建议** (基于面积自动推荐设备配置) | P0 |
| 基础对齐 | + **安全距离检测** (设备间距、通道宽度自动校验) | P0 |
| 导出图片 | + **导出 DWG/PDF** 专业格式 | P1 |
| 模板库 | + **社区模板共享** (用户上传、评分、fork) | P2 |

### 4.2 3D 预览增强

| 现有功能 | 增强方向 | 优先级 |
|---------|---------|--------|
| 基础 3D 渲染 | + **VR 模式** (支持 WebXR，可用 VR 头显体验) | P1 |
| 静态预览 | + **漫游模式** (WASD 键盘控制第一人称走动) | P0 |
| 单一视角 | + **多视角切换** (俯视/透视/立面/剖面) | P1 |
| - | + **光照模拟** (自然光时段变化、人工光效果) | P2 |

### 4.3 预算仪表盘增强

| 现有功能 | 增强方向 | 优先级 |
|---------|---------|--------|
| 成本计算 | + **分期采购方案** (按优先级生成采购批次) | P0 |
| 设备报价 | + **实时比价** (对接淘宝/京东 API 或爬虫) | P2 |
| 总预算 | + **TCO 计算** (含5年维护、耗材、人员成本) | P1 |
| - | + **预算模板** (小型/中型/大型空间预设方案) | P0 |

### 4.4 新增工具

#### 课程排期工具 (P1)

```
┌─────────────────────────────────────────┐
│ 📅 课程排期工具                          │
├─────────────────────────────────────────┤
│ 功能:                                   │
│ - 可视化周课表编排 (拖拽式)              │
│ - 设备占用冲突自动检测                   │
│ - 导师时间匹配建议                       │
│ - 教室/工位容量校验                      │
│ - 导出 iCal / Google Calendar           │
└─────────────────────────────────────────┘
```

#### 设备生命周期管理 (P1)

```
┌─────────────────────────────────────────┐
│ 🔧 设备生命周期管理                      │
├─────────────────────────────────────────┤
│ 功能:                                   │
│ - 设备台账 (型号、购入日期、保修期)       │
│ - 维护提醒日历 (定期保养通知)            │
│ - 耗材库存追踪 (低库存预警)              │
│ - 故障报修工单流程                       │
│ - 使用时长统计和利用率分析               │
└─────────────────────────────────────────┘
```

#### 成果展示墙 (P2)

```
┌─────────────────────────────────────────┐
│ 🎨 成果展示墙                            │
├─────────────────────────────────────────┤
│ 功能:                                   │
│ - 学生项目作品集 (图片/视频/3D模型)       │
│ - 时间线展示 (按学期/项目分类)           │
│ - 一键生成分享海报                       │
│ - 作品点赞和评论                         │
│ - 嵌入代码 (可嵌入学校官网)              │
└─────────────────────────────────────────┘
```

---

## 模块间协同架构

```
                 ┌──────────────────┐
                 │  Agentic RAG     │
                 │  (智能中枢)       │
                 └────────┬─────────┘
                          │ 调用
        ┌─────────────────┼─────────────────┐
        ↓                 ↓                 ↓
┌───────────────┐ ┌───────────────┐ ┌───────────────┐
│  推荐系统      │ │  可视化组件    │ │  Lab 工具     │
│  (方案生成)    │ │  (内容展示)    │ │  (规划执行)   │
└───────┬───────┘ └───────┬───────┘ └───────┬───────┘
        │                 │                 │
        └─────────────────┴─────────────────┘
                          │
                          ↓
                ┌──────────────────┐
                │  OWL 知识库       │
                │  (Core+Extend+   │
                │   Evidence)      │
                └──────────────────┘
```

**协同场景示例**:

1. 用户在 AI 问答中问"如何建50㎡创客空间"
2. Agent 调用推荐系统生成方案
3. 方案中的设备清单可一键导入平面图编辑器
4. 编辑完成后生成 3D 预览
5. 确认后导出预算表和采购清单

---

## 实施路线图

### Phase 1: 基础设施 (Week 1-2)

- [ ] 知识库向量化索引构建
- [ ] Agentic RAG 基础框架搭建
- [ ] 基础问答功能上线

### Phase 2: 智能推荐 (Week 3-4)

- [ ] 推荐系统参数化接口
- [ ] 与现有 API 集成
- [ ] 推荐向导 UI

### Phase 3: 可视化组件 (Week 5-6)

- [ ] 知识图谱组件
- [ ] 交互式检查清单组件
- [ ] 流程图组件

### Phase 4: Lab 工具增强 (Week 7-8)

- [ ] 平面图智能布局
- [ ] 3D 漫游模式
- [ ] 预算分期方案

### Phase 5: 新工具开发 (Week 9-12)

- [ ] 课程排期工具
- [ ] 设备生命周期管理
- [ ] 成果展示墙

---

## 技术栈总览

| 层级 | 技术选型 |
|------|----------|
| **前端框架** | Next.js 14+ (App Router) |
| **UI 组件** | shadcn/ui + Tailwind CSS |
| **3D 渲染** | Three.js + React Three Fiber |
| **可视化** | D3.js / React Flow / Mermaid |
| **AI/LLM** | Vercel AI SDK + OpenAI / Anthropic |
| **向量数据库** | Vercel Postgres + pgvector / Pinecone |
| **实时协作** | (可选) Liveblocks / Y.js |
| **文件存储** | Vercel Blob / Cloudflare R2 |

---

## 附录

### A. 现有 API 清单

| API | 功能 | 状态 |
|-----|------|------|
| `/api/ai/chat` | AI 聊天 | ✅ 已有 |
| `/api/ai/generate-diagram` | 生成图表 | ✅ 已有 |
| `/api/ai/generate-layout` | 生成布局 | ✅ 已有 |
| `/api/ai/budget-analysis` | 预算分析 | ✅ 已有 |
| `/api/ai/recommend-equipment` | 设备推荐 | ✅ 已有 |
| `/api/ai/safety-analysis` | 安全分析 | ✅ 已有 |
| `/api/search` | 搜索 | ✅ 已有 |

### B. 现有组件清单

| 组件 | 功能 | 位置 |
|------|------|------|
| AIChatPanel | AI 聊天面板 | `components/lab/` |
| FloorPlanCanvas | 平面图编辑器 | `components/lab/` |
| Preview3D | 3D 预览 | `components/lab/` |
| BudgetDashboard | 预算仪表盘 | `components/lab/` |
| EquipmentLibrary | 设备库 | `components/lab/` |
| SafetyPanel | 安全面板 | `components/lab/` |
| TemplateGallery | 模板库 | `components/lab/` |

---

*文档生成时间: 2025-12-29*
*审核状态: 已通过*
